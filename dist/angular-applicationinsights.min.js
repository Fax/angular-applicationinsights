/*! angular-applicationinsights version 0.1.1 2015-03-04 */
!function(a){"use strict";function b(a){var b,c,d,e,f,g=o;this.setInterceptFunction=function(a){g=a},this.getPrivateLoggingObject=function(){return{debug:r(b)?o:b,info:r(c)?o:c,warn:r(d)?o:d,error:r(e)?o:e,log:r(f)?o:f}};var h=function(a,b){return function(){var c=[].slice.call(arguments);g(c[0],b),a.apply(null,c)}};a.decorator("$log",["$delegate",function(a){return b=a.debug,c=a.info,d=a.warn,e=a.error,f=a.log,a.debug=h(b,"debug"),a.info=h(c,"info"),a.warn=h(d,"warn"),a.error=h(e,"error"),a.log=h(f,"log"),a}])}function c(a){var b,c=o;this.setInterceptFunction=function(a){c=a},this.getPrivateExceptionHanlder=function(){return r(b)?o:b},a.decorator("$exceptionHandler",["$delegate",function(a){return b=a,function(a,d){c(a,d),b(a,d)}}])}function d(a,b,c,d,e,f){i(a)||this.setFunctionName(a),i(b)||this.setArgs(b),i(c)||this.setFileName(c),i(d)||this.setLineNumber(d),i(e)||this.setColumnNumber(e),i(f)||this.setLevelNumber(f)}var e,f,g="angular:0.1.1",h="https://dc.services.visualstudio.com/v2/track",i=(a.isDefined,a.isUndefined),j=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},k=a.isObject,l=a.isArray,m=a.isString,n=a.extend,o=(a.toJson,a.fromJson,a.forEach,a.noop),p=/\S+\:\d+/,q=/\s+at /,r=function(a){return i(a)||null===a},s=function(){for(var a=[],b="0123456789abcdef",c=0;36>c;c++)a[c]=b.substr(Math.floor(16*Math.random()),1);return a[8]=a[13]=a[18]=a[23]="-",a[14]="4",a[19]=b.substr(3&a[19]|8,1),a.join("")};d.prototype={getFunctionName:function(){return this.method},setFunctionName:function(a){this.method=String(a)},getArgs:function(){return this.args},setArgs:function(a){if("[object Array]"!==Object.prototype.toString.call(a))throw new TypeError("Args must be an Array");this.args=a},getFileName:function(){return this.fileName},setFileName:function(a){this.fileName=String(a)},getLineNumber:function(){return this.line},setLineNumber:function(a){if(!j(a))throw new TypeError("Line Number must be a Number");this.line=Number(a)},getColumnNumber:function(){return this.column},setColumnNumber:function(a){if(!j(a))throw new TypeError("Column Number must be a Number");this.column=Number(a)},getLevelNumber:function(){return this.level},setLevelNumber:function(a){if(!j(a))throw new TypeError("Level Number must be a Number");this.level=Number(a)},toString:function(){var a=this.getFunctionName()||"{anonymous}",b="("+(this.getArgs()||[]).join(",")+")",c=this.getFileName()?"@"+this.getFileName():"",d=j(this.getLineNumber())?":"+this.getLineNumber():"",e=j(this.getColumnNumber())?":"+this.getColumnNumber():"";return a+b+c+d+e}};var t={parse:function(a){return"undefined"!=typeof a.stacktrace||"undefined"!=typeof a["opera#sourceloc"]?this.parseOpera(a):a.stack&&a.stack.match(q)?this.parseV8OrIE(a):a.stack&&a.stack.match(p)?this.parseFFOrSafari(a):null},extractLocation:function(a){var b=a.split(":"),c=b.pop(),d=b[b.length-1];if(!isNaN(parseFloat(d))&&isFinite(d)){var e=b.pop();return[b.join(":"),e,c]}return[b.join(":"),c,void 0]},parseV8OrIE:function(a){var b=0;return a.stack.split("\n").slice(1).map(function(a){var c=a.replace(/^\s+/,"").split(/\s+/).slice(1),e=this.extractLocation(c.pop().replace(/[\(\)\s]/g,"")),f=c[0]&&"Anonymous"!==c[0]?c[0]:void 0;return new d(f,void 0,e[0],e[1],e[2],b++)},this)},parseFFOrSafari:function(a){var b=0;return a.stack.split("\n").filter(function(a){return!!a.match(p)},this).map(function(a){var c=a.split("@"),e=this.extractLocation(c.pop()),f=c.shift()||void 0;return new d(f,void 0,e[0],e[1],e[2],b++)},this)},parseOpera:function(a){return!a.stacktrace||a.message.indexOf("\n")>-1&&a.message.split("\n").length>a.stacktrace.split("\n").length?this.parseOpera9(a):a.stack?this.parseOpera11(a):this.parseOpera10(a)},parseOpera9:function(a){for(var b=/Line (\d+).*script (?:in )?(\S+)/i,c=a.message.split("\n"),e=[],f=0,g=2,h=c.length;h>g;g+=2){var i=b.exec(c[g]);i&&e.push(new d(void 0,void 0,i[2],i[1],f++))}return e},parseOpera10:function(a){for(var b=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,c=a.stacktrace.split("\n"),e=[],f=0,g=0,h=c.length;h>g;g+=2){var i=b.exec(c[g]);i&&e.push(new d(i[3]||void 0,void 0,i[2],i[1],f++))}return e},parseOpera11:function(a){return a.stack.split("\n").filter(function(a){return!!a.match(p)&&!a.match(/^Error created at/)},this).map(function(a){var b,c=a.split("@"),e=this.extractLocation(c.pop()),f=c.shift()||"",g=f.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0;f.match(/\(([^\)]*)\)/)&&(b=f.replace(/^[^\(]+\(([^\)]*)\)$/,"$1"));var h=void 0===b||"[arguments not available]"===b?void 0:b.split(",");return new d(g,h,e[0],e[1],e[2])},this)}},u=a.module("ApplicationInsightsModule",["LocalStorageModule"]);u.config(["$provide",function(a){e=new b(a),f=new c(a)}]),u.provider("applicationInsightsService",function(){function a(a,d,i,n,o){var p=e.getPrivateLoggingObject(),q=(f.getPrivateExceptionHanlder(),"application/json"),u="Microsoft.ApplicationInsights.",v={pageViews:u+"Pageview",traceMessage:u+"Message",events:u+"Event",metrics:u+"Metric",exception:u+"Exception"},w={pageViews:u+"PageviewData",traceMessage:u+"MessageData",events:u+"EventData",metrics:u+"MetricData",exception:u+"ExceptionData"},x=function(){var b="$$appInsights__uuid",c=a.get(b);return r(c)&&(c=s(),a.set(b,c)),c},y="$$appInsights__session",z=function(){var b={id:s(),accessed:(new Date).getTime()};return a.set(y,b),b},A=function(){var b=a.get(y);if(r(b))b=z();else{var d=r(b.accessed)?0:b.accessed,e=(new Date).getTime();e-d>c.sessionInactivityTimeout?b=z():(b.accessed=e,a.set(y,b))}return b.id},B=function(a){if(r(a))return null;if(!k(a))return p.warn("The value of the measurements parameter must be an object consisting of a string/number pairs."),null;var b={};for(var c in a)j(a[c])?b[c]=a[c]:p.warn("The value of measurement "+c+" is not a number.");return b},C=function(a){if(r(a))return null;if(!k(a))return p.warn("The value of the properties parameter must be an object consisting of a string/string pairs."),null;var b={};for(var c in a){var d=a[c];r(d)||k(d)||l(d)?p.warn("The value of property "+c+" could not be determined to be a string or number."):b[c]=d}return b},D=function(a){var b={method:"POST",url:h,headers:{"Content-Type":q},data:a};d(b)},E=function(a,b,c,d){var e=J(v.pageViews,w.pageViews,{ver:1,url:r(b)?o.absUrl():b,name:r(a)?o.path():a,properties:C(c),measurements:B(d)});D(e)},F=function(a,b,c){var d=J(v.events,w.events,{ver:1,name:a,properties:C(b),measurements:B(c)});D(d)},G=function(a,b,c){if(!r(a)&&m(a)){var d=J(v.traceMessage,w.traceMessage,{ver:1,message:a,severity:b,properties:C(c)});D(d)}},H=function(a,b,c){var d=J(v.metrics,w.metrics,{ver:1,metrics:[{name:a,value:b}],properties:C(c)});D(d)},I=function(a){if(!r(a)){var b=t.parse(a),c=J(v.exception,w.exception,{ver:1,handledAt:"Unhandled",exceptions:[{typeName:a.name,message:a.message,stack:a.stack,parsedStack:b,hasFullStack:!r(b)}]});D(c)}},J=function(a,c,d){return{name:a,time:(new Date).toISOString(),ver:1,iKey:b,user:{id:x()},session:{id:A()},operation:{id:s()},device:{id:"browser",locale:i.id,resolution:n.screen.availWidth+"x"+n.screen.availHeight},internal:{sdkVersion:g},data:{type:c,item:d}}};return c.autoLogTracking&&e.setInterceptFunction(G),c.autoExceptionTracking&&f.setInterceptFunction(I),{trackPageView:E,trackTraceMessage:G,trackEvent:F,trackMetric:H,applicationName:c.applicationName,autoPageViewTracking:c.autoPageViewTracking}}var b="",c={applicationName:"",autoPageViewTracking:!0,autoLogTracking:!0,autoExceptionTracking:!0,sessionInactivityTimeout:18e5};this.configure=function(a,d,e){m(d)?(b=a,c.applicationName=d,c.autoPageViewTracking=r(e)?!0:e):(n(c,d),b=a)},this.$get=["localStorageService","$http","$locale","$window","$location",function(b,c,d,e,f){return new a(b,c,d,e,f)}]}).run(["$rootScope","$location","applicationInsightsService",function(a,b,c){a.$on("$locationChangeSuccess",function(){c.autoPageViewTracking&&c.trackPageView(c.applicationName+b.path())})}])}(window.angular);
/*! angular-applicationinsights version 0.2.6 2015-11-28 */
!function(a){{var b,c,d=function(){function a(b){a.isDefined=b.isDefined,a.isUndefined=b.isUndefined,a.isObject=b.isObject,a.isArray=b.isArray,a.isString=b.isString,a.extend=b.extend,a.toJson=b.toJson,a.fromJson=b.fromJson,a.forEach=b.forEach,a.noop=b.noop}return a.isNullOrUndefined=function(b){return a.isUndefined(b)||null===b},a.isNumber=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},a.generateGuid=function(){for(var a=[],b="0123456789abcdef",c=0;36>c;c++)a[c]=b.substr(Math.floor(16*Math.random()),1);return a[8]=a[13]=a[18]=a[23]="-",a[14]="4",a[19]=b.substr(3&a[19]|8,1),a.join("")},a.msToTimeSpan=function(a){(isNaN(a)||0>a)&&(a=0);var b=""+a%1e3,c=""+Math.floor(a/1e3)%60,d=""+Math.floor(a/6e4)%60,e=""+Math.floor(a/36e5)%24;return b=1===b.length?"00"+b:2===b.length?"0"+b:b,c=c.length<2?"0"+c:c,d=d.length<2?"0"+d:d,e=e.length<2?"0"+e:e,e+":"+d+":"+c+"."+b},a}(),e=function(){function a(b){var c=this;this._config=d.extend(a.defaultConfig,b),this._self=this._config,this._prefix=this._config.prefix,this._cookie=this._config.cookie,this._notify=this._config.notify,this._storageType=this._config.storageType,this._$rootScope=this._config.rootScope,this._$window=this._config.window,this._$document=this._config.document,this._$parse=this._config.parse,this._$document?this._$document[0]&&(this._$document=this._$document[0]):this._$document=document,"."!==this._prefix.substr(-1)&&(this._prefix=this._prefix?this._prefix+".":""),this._deriveQualifiedKey=function(a){return c._prefix+a}}return a.prototype.isStringNumber=function(a){return/^-?\d+\.?\d*$/.test(a.replace(/["']/g,""))},a.prototype.browserSupportsLocalStorage=function(){try{var a=this._storageType in this._$window&&null!==this._$window[this._storageType],b=this._deriveQualifiedKey("__"+Math.round(1e7*Math.random()));return a&&(this._webStorage=this._$window[this._storageType],this._webStorage.setItem(b,""),this._webStorage.removeItem(b)),a}catch(c){return this._storageType="cookie",this._$rootScope.$broadcast("AngularAppInsights.Storage.notification.error",c.message),!1}},a.prototype.browserSupportsCookies=function(){try{return this._$window.navigator.cookieEnabled||"cookie"in this._$document&&(this._$document.cookie.length>0||(this._$document.cookie="test").indexOf.call(this._$document.cookie,"test")>-1)}catch(a){return this._$rootScope.$broadcast("AngularAppInsights.Storage.notification.error",a.message),!1}},a.prototype.addToCookies=function(a,b){if(d.isUndefined(b))return!1;if((d.isArray(b)||d.isObject(b))&&(b=d.toJson(b)),!this.browserSupportsCookies)return this._$rootScope.$broadcast("AngularAppInsights.Storage.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var c="",e=new Date,f="";if(null===b?(e.setTime(e.getTime()+-864e5),c="; expires="+e.toUTCString(),b=""):0!==this._cookie.expiry&&(e.setTime(e.getTime()+24*this._cookie.expiry*60*60*1e3),c="; expires="+e.toUTCString()),a){var g="; path="+this._cookie.path;this._cookie.domain&&(f="; domain="+this._cookie.domain),this._$document.cookie=this._deriveQualifiedKey(a)+"="+encodeURIComponent(b)+c+g+f}}catch(h){return this._$rootScope.$broadcast("AngularAppInsights.Storage.notification.error",h.message),!1}return!0},a.prototype.getFromCookies=function(a){if(!this.browserSupportsCookies)return this._$rootScope.$broadcast("AngularAppInsights.Storage.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var b=this._$document.cookie&&this._$document.cookie.split(";")||[],c=0;c<b.length;c++){for(var e=b[c];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(this._deriveQualifiedKey(a)+"=")){var f=decodeURIComponent(e.substring(this._prefix.length+a.length+1,e.length));try{var g=JSON.parse(f);return d.fromJson(g)}catch(h){return f}}}return null},a.prototype.addToLocalStorage=function(a,b){if(d.isUndefined(b)?b=null:(d.isObject(b)||d.isArray(b)||d.isNumber(+b||b))&&(b=d.toJson(b)),!this.browserSupportsLocalStorage()||"cookie"===this._self.storageType)return this.browserSupportsLocalStorage()||this._$rootScope.$broadcast("AngularAppInsights.Storage.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),this._notify.setItem&&this._$rootScope.$broadcast("AngularAppInsights.Storage.notification.setitem",{key:a,newvalue:b,storageType:"cookie"}),this.addToCookies(a,b);try{(d.isObject(b)||d.isArray(b))&&(b=d.toJson(b)),this._webStorage&&this._webStorage.setItem(this._deriveQualifiedKey(a),b),this._notify.setItem&&this._$rootScope.$broadcast("AngularAppInsights.Storage.notification.setitem",{key:a,newvalue:b,storageType:this._self.storageType})}catch(c){return this._$rootScope.$broadcast("AngularAppInsights.Storage.notification.error",c.message),this.addToCookies(a,b)}return!0},a.prototype.getFromLocalStorage=function(a){if(!this.browserSupportsLocalStorage()||"cookie"===this._self.storageType)return this.browserSupportsLocalStorage()||this._$rootScope.$broadcast("AngularAppInsights.Storage.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),this.getFromCookies(a);var b=this._webStorage?this._webStorage.getItem(this._deriveQualifiedKey(a)):null;return b&&"null"!==b?"{"===b.charAt(0)||"["===b.charAt(0)||this.isStringNumber(b)?d.fromJson(b):b:null},a.prototype.getStorageType=function(){return this._storageType},a.prototype.isSupported=function(){return this.browserSupportsLocalStorage()},a.prototype.set=function(a,b){return this.addToLocalStorage(a,b)},a.prototype.get=function(a){return this.getFromLocalStorage(a)},a.prototype.deriveKey=function(a){return this._deriveQualifiedKey(a)},a.prototype.isCookiesSupported=function(){return this.browserSupportsCookies()},a.prototype.setCookie=function(a,b){this.addToCookies(a,b)},a.prototype.getCookie=function(a){return this.getFromCookies(a)},a.defaultConfig={prefix:"ls",storageType:"localStorage",cookie:{expiry:30,path:"/"},notify:{setItem:!0,removeItem:!1}},a}(),f=(function(){function a(){}return a}(),function(){function a(){}return a}()),g=function(){function a(a,b,c,e,f,g){d.isUndefined(a)||this.setFunctionName(a),d.isUndefined(f)||this.setColumnNumber(f),d.isUndefined(b)||this.setArgs(b),d.isUndefined(c)||this.setFileName(c),d.isUndefined(e)||this.setLineNumber(e),d.isUndefined(g)||this.setLevelNumber(g)}return a.prototype.setFunctionName=function(a){this.method=String(a)},a.prototype.setArgs=function(a){if("[object Array]"!==Object.prototype.toString.call(a))throw new TypeError("Args must be an Array");this.args=a},a.prototype.setFileName=function(a){this.fileName=String(a)},a.prototype.setLineNumber=function(a){return d.isNumber(a)?void(this.lineNumber=Number(a)):void(this.lineNumber=void 0)},a.prototype.setColumnNumber=function(a){return d.isNumber(a)?void(this.columnNumber=Number(a)):void(this.columnNumber=void 0)},a.prototype.setLevelNumber=function(a){if(!d.isNumber(a))throw new TypeError("Level Number must be a Number");this.level=Number(a)},a.prototype.toString=function(){var a=this.method||"{anonymous}",b="("+(this.args||[]).join(",")+")",c=this.fileName?"@"+this.fileName:"",e=d.isNumber(this.lineNumber)?":"+this.lineNumber:"",f=d.isNumber(this.columnNumber)?":"+this.columnNumber:"";return a+b+c+e+f},a}(),h=function(){function a(){}return a.parse=function(b){return"undefined"!=typeof b.stacktrace||"undefined"!=typeof b["opera#sourceloc"]?a.parseOpera(b):b.stack&&b.stack.match(a.chromeIeStackRegexp)?a.parseChromeOrInternetExplorer(b):b.stack&&b.stack.match(a.firefoxSafariStackRegexp)?a.parseFireFoxOrSafari(b):null},a.extractLocation=function(a){if(-1===a.indexOf(":"))return[];var b=a.split(":"),c=b.pop(),d=b[b.length-1];if(!isNaN(parseFloat(d))&&isFinite(d)){var e=b.pop();return[b.join(":"),e,c]}return[b.join(":"),c,void 0]},a.parseChromeOrInternetExplorer=function(a){var b=this,c=0;return a.stack.split("\n").slice(1).map(function(a){var d=a.replace(/^\s+/,"").split(/\s+/).slice(1),e=void 0!==d[0]?b.extractLocation(d.pop().replace(/[\(\)\s]/g,"")):["unknown","unknown","unknown"],f=d[0]&&"Anonymous"!==d[0]?d[0]:"unknown";return new g(f,void 0,e[0],e[1],e[2],c++)},this)},a.parseFireFoxOrSafari=function(b){var c=this,d=0;return b.stack.split("\n").filter(function(b){return!!b.match(a.firefoxSafariStackRegexp)},this).map(function(a){var b=a.split("@"),e=c.extractLocation(b.pop()),f=b.shift()||"unknown";return new g(f,void 0,e[0],e[1],e[2],d++)},this)},a.parseOpera=function(a){return!a.stacktrace||a.message.indexOf("\n")>-1&&a.message.split("\n").length>a.stacktrace.split("\n").length?this.parseOpera9(a):a.stack?this.parseOpera11(a):this.parseOpera10(a)},a.parseOpera9=function(a){for(var b=/Line (\d+).*script (?:in )?(\S+)/i,c=a.message.split("\n"),d=[],e=2,f=c.length;f>e;e+=2){var h=b.exec(c[e]);if(h){var i=0;d.push(new g(void 0,void 0,h[2],h[1],void 0,i++))}}return d},a.parseOpera10=function(a){for(var b=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,c=a.stacktrace.split("\n"),d=[],e=0,f=c.length;f>e;e+=2){var h=b.exec(c[e]);if(h){var i=0;d.push(new g(h[3]||void 0,void 0,h[2],h[1],void 0,i++))}}return d},a.parseOpera11=function(b){var c=0;return b.stack.split("\n").filter(function(b){return!!b.match(a.firefoxSafariStackRegexp)&&!b.match(/^Error created at/)},this).map(function(b){var d,e=b.split("@"),f=a.extractLocation(e.pop()),h=e.shift()||"",i=h.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0;h.match(/\(([^\)]*)\)/)&&(d=h.replace(/^[^\(]+\(([^\)]*)\)$/,"$1"));var j=void 0===d||"[arguments not available]"===d?void 0:d?d.split(","):"";return new g(i,j,f[0],f[1],f[2],c++)},this)},a.firefoxSafariStackRegexp=/\S+\:\d+/,a.chromeIeStackRegexp=/\s+at /,a}(),i=function(){function a(b,c){var d=this;this._angular=c,this._noop=this._angular.noop,a.interceptFuntion=this._noop,b.decorator("$log",["$delegate",function(a){return d._debugFn=a.debug,d._infoFn=a.info,d._warnFn=a.warn,d._errorFn=a.error,d._logFn=a.log,a.debug=d.delegator(d._debugFn,"debug"),a.info=d.delegator(d._infoFn,"info"),a.warn=d.delegator(d._warnFn,"warn"),a.error=d.delegator(d._errorFn,"error"),a.log=d.delegator(d._logFn,"log"),a}])}return a.prototype.setInterceptFunction=function(b){a.interceptFuntion=b},a.prototype.getPrivateLoggingObject=function(){return{debug:d.isNullOrUndefined(this._debugFn)?d.noop:this._debugFn,info:d.isNullOrUndefined(this._infoFn)?d.noop:this._infoFn,warn:d.isNullOrUndefined(this._warnFn)?d.noop:this._warnFn,error:d.isNullOrUndefined(this._errorFn)?d.noop:this._errorFn,log:d.isNullOrUndefined(this._logFn)?d.noop:this._logFn}},a.prototype.delegator=function(b,c){return function(){var d=[].slice.call(arguments);a.interceptFuntion(d[0],c),b.apply(null,d)}},a}(),j=function(){function a(b){var c=this;a.errorOnHttpCall=!1,this._interceptFunction=d.noop,b.decorator("$exceptionHandler",["$delegate",function(b){return c._origExceptionHandler=b,function(b,d){a.errorOnHttpCall||c._interceptFunction(b,d),c._origExceptionHandler(b,d)}}])}return a.prototype.setInterceptFunction=function(a){this._interceptFunction=a},a.prototype.getPrivateExceptionHanlder=function(){return d.isNullOrUndefined(this._origExceptionHandler)?d.noop:this._origExceptionHandler},a}(),k=function(){function a(){this.applicationName="",this.autoPageViewTracking=!0,this.autoLogTracking=!0,this.autoExceptionTracking=!0,this.sessionInactivityTimeout=18e5,this.instrumentationKey=""}return a}(),l=function(){function a(a,b,c,d,e,f,g,h){var i=this;this._sessionKey="$$appInsights__session",this._version="angular:0.2.6",this._analyticsServiceUrl="https://dc.services.visualstudio.com/v2/track",this._contentType="application/json",this._localStorage=a,this._http=b,this._locale=c,this._window=d,this._location=e,this.options=h,this._log=f.getPrivateLoggingObject(),this._exceptionHandler=g.getPrivateExceptionHanlder(),this._logInterceptor=f,this._exceptionInterceptor=g,this.options.autoLogTracking&&this._logInterceptor.setInterceptFunction(function(a,b,c){return i.trackTraceMessage(a,b,c)}),this.options.autoExceptionTracking&&this._exceptionInterceptor.setInterceptFunction(function(a,b){return i.trackException(a,b)})}return a.prototype.getUniqueId=function(){var a="$$appInsights__uuid",b=this._localStorage.get(a);return d.isNullOrUndefined(b)&&(b=d.generateGuid(),this._localStorage.set(a,b)),b},a.prototype.makeNewSession=function(){var a={id:d.generateGuid(),accessed:(new Date).getTime()};return this._localStorage.set(this._sessionKey,a),a},a.prototype.getSessionId=function(){var a=this._localStorage.get(this._sessionKey);if(d.isNullOrUndefined(a))a=this.makeNewSession();else{var b=d.isNullOrUndefined(a.accessed)?0:a.accessed,c=(new Date).getTime();c-b>this.options.sessionInactivityTimeout?a=this.makeNewSession():(a.accessed=c,this._localStorage.set(this._sessionKey,a))}return a.id},a.prototype.isPerformanceTimingDataReady=function(){var a=this._window.performance.timing;return a.domainLookupStart>0&&a.navigationStart>0&&a.responseStart>0&&a.requestStart>0&&a.loadEventEnd>0&&a.responseEnd>0&&a.connectEnd>0&&a.domLoading>0},a.prototype.validateMeasurements=function(a){if(d.isNullOrUndefined(a))return null;if(!d.isObject(a))return this._log.warn("The value of the measurements parameter must be an object consisting of a string/number pairs."),null;var b={};for(var c in a)d.isNumber(a[c])?b[c]=a[c]:this._log.warn("The value of measurement "+c+" is not a number.");return b},a.getDuration=function(a,b){var c=0;return isNaN(a)||isNaN(b)||(c=Math.max(b-a,0)),c},a.prototype.validateProperties=function(a){if(d.isNullOrUndefined(a))return null;if(!d.isObject(a))return this._log.warn("The value of the properties parameter must be an object consisting of a string/string pairs."),null;var b={};for(var c in a){var e=a[c];d.isNullOrUndefined(e)||d.isObject(e)||d.isArray(e)?this._log.warn("The value of property "+c+" could not be determined to be a string or number."):b[c]=e}return b},a.prototype.validateSeverityLevel=function(a){var b=["debug","info","warn","error"],c=b.indexOf(a);return c>-1?c:0},a.prototype.sendData=function(a){var b=new f;for(var c in this._http.defaults.headers.common)b[c]=void 0;for(var d in this._http.defaults.headers.post)b[d]=void 0;b.Accept=this._contentType,b["Content-Type"]=this._contentType;var e={method:"POST",url:this._analyticsServiceUrl,headers:b,data:a,withCredentials:!1};try{this._http(e).success(function(){j.errorOnHttpCall=!1}).error(function(){j.errorOnHttpCall=!0})}catch(g){}},a.prototype.trackPageView=function(b,c,e,f){var g=this.generateAppInsightsData(a.names.pageViews,a.types.pageViews,{ver:1,url:d.isNullOrUndefined(c)?this._location.absUrl():c,name:d.isNullOrUndefined(b)?this._location.path():b,properties:this.validateProperties(e),measurements:this.validateMeasurements(f)});this.sendData(g)},a.prototype.trackPageViewPerformance=function(b,c,e,f){if(!d.isNullOrUndefined(this._window)&&!d.isNullOrUndefined(this._window.performance)&&!d.isNullOrUndefined(this._window.performance.timing)){var g=window.performance.timing,h=a.getDuration(g.navigationStart,g.connectEnd),i=a.getDuration(g.requestStart,g.responseStart),j=a.getDuration(g.responseStart,g.responseEnd),k=a.getDuration(g.responseEnd,g.loadEventEnd),l=a.getDuration(g.navigationStart,g.loadEventEnd);if(0===l);else if(l<Math.floor(h)+Math.floor(i)+Math.floor(j)+Math.floor(k));else{var m=d.msToTimeSpan(l),n=d.msToTimeSpan(h),o=d.msToTimeSpan(i),p=d.msToTimeSpan(j),q=d.msToTimeSpan(k),r=this.generateAppInsightsData(a.names.pageViewPerformance,a.types.pageViewPerformance,{ver:1,url:d.isNullOrUndefined(c)?this._location.absUrl():c,name:d.isNullOrUndefined(b)?this._location.path():b,properties:this.validateProperties(e),measurements:this.validateMeasurements(f),duration:l,networkConnect:n,sentRequest:o,receivedResponse:p,domProcessing:q,perfTotal:m});this.sendData(r)}}},a.prototype.trackEvent=function(b,c,d){var e=this.generateAppInsightsData(a.names.events,a.types.events,{ver:1,name:b,properties:this.validateProperties(c),measurements:this.validateMeasurements(d)});this.sendData(e)},a.prototype.trackTraceMessage=function(b,c,e){if(!d.isNullOrUndefined(b)&&d.isString(b)){var f=this.generateAppInsightsData(a.names.traceMessage,a.types.traceMessage,{ver:1,message:b,severityLevel:this.validateSeverityLevel(c),properties:this.validateProperties(e)});this.sendData(f)}},a.prototype.trackMetric=function(b,c,d){var e=this.generateAppInsightsData(a.names.metrics,a.types.metrics,{ver:1,metrics:[{name:b,value:c}],properties:this.validateProperties(d)});this.sendData(e)},a.prototype.trackException=function(b){if(!d.isNullOrUndefined(b)){var c=h.parse(b),e=this.generateAppInsightsData(a.names.exception,a.types.exception,{ver:1,handledAt:"Unhandled",exceptions:[{typeName:b.name,message:b.message,stack:b.stack,parsedStack:c,hasFullStack:!d.isNullOrUndefined(c)}]});this.sendData(e)}},a.prototype.generateAppInsightsData=function(a,b,c){return this._commonProperties&&(c.properties=c.properties||{},d.extend(c.properties,this._commonProperties)),{name:a,time:(new Date).toISOString(),ver:1,iKey:this.options.instrumentationKey,user:{id:this.getUniqueId()},session:{id:this.getSessionId()},operation:{id:d.generateGuid()},device:{id:"browser",locale:this._locale.id,resolution:this._window.screen.availWidth+"x"+this._window.screen.availHeight},internal:{sdkVersion:this._version},data:{type:b,item:c}}},a.prototype.setCommonProperties=function(a){this.validateProperties(a),this._commonProperties=this._commonProperties||{},d.extend(this._commonProperties,a)},a.namespace="Microsoft.ApplicationInsights.",a.names={pageViews:a.namespace+"Pageview",pageViewPerformance:a.namespace+"PageviewPerformance",traceMessage:a.namespace+"Message",events:a.namespace+"Event",metrics:a.namespace+"Metric",exception:a.namespace+"Exception"},a.types={pageViews:a.namespace+"PageviewData",pageViewPerformance:a.namespace+"PageviewPerformanceData",traceMessage:a.namespace+"MessageData",events:a.namespace+"EventData",metrics:a.namespace+"MetricData",exception:a.namespace+"ExceptionData"},a}(),m=a.module("ApplicationInsightsModule",[]);new d(a)}m.config(["$provide",function(d){b=new i(d,a),c=new j(d)}]),m.provider("applicationInsightsService",function(){return new n}),m.run(["$rootScope","$location","$interval","applicationInsightsService",function(a,b,c,d){a.$on("$locationChangeSuccess",function(){if(d.options.autoPageViewTracking){d.trackPageView(d.options.applicationName+b.path());var a=c(function(){d.isPerformanceTimingDataReady()&&(d.trackPageViewPerformance(d.options.applicationName+b.path()),c.cancel(a))},250)}})}]);var n=function(){function a(){var a=this;this._options=new k,this.$get=["$http","$locale","$window","$location","$rootScope","$parse","$document",function(d,f,g,h,i,j,k){var m=new e({window:g,rootScope:i,document:k,parse:j});return new l(m,d,f,g,h,b,c,a._options)}]}return a.prototype.configure=function(a,b,c){d.isString(b)?(this._options.instrumentationKey=a,this._options.applicationName=b,this._options.autoPageViewTracking=d.isNullOrUndefined(c)?!0:c):(d.extend(this._options,b),this._options.instrumentationKey=a)},a}()}(window.angular);